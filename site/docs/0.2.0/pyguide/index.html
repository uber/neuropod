



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>Python Guide - Neuropod</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.1b62728e.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="https://unpkg.com/mermaid@7.1.2/dist/mermaid.css">
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-7627242-14", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#python-guide" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Neuropod" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Neuropod
            </span>
            <span class="md-header-nav__topic">
              
                Python Guide
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Neuropod" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Neuropod
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Welcome" class="md-nav__link">
      Welcome
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../installing/" title="Installing" class="md-nav__link">
      Installing
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../tutorial/" title="Basic Introduction" class="md-nav__link">
      Basic Introduction
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Packaging API
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Packaging API
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../packagers/tensorflow/" title="TensorFlow" class="md-nav__link">
      TensorFlow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../packagers/pytorch/" title="PyTorch" class="md-nav__link">
      PyTorch
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../packagers/torchscript/" title="TorchScript" class="md-nav__link">
      TorchScript
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../packagers/keras/" title="Keras" class="md-nav__link">
      Keras
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Python Guide
      </label>
    
    <a href="./" title="Python Guide" class="md-nav__link md-nav__link--active">
      Python Guide
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#packaging-a-neuropod" class="md-nav__link">
    Packaging a Neuropod
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loading-a-neuropod" class="md-nav__link">
    Loading a Neuropod
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#options" class="md-nav__link">
    Options
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-the-inputs-and-outputs-of-a-model" class="md-nav__link">
    Get the inputs and outputs of a model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inference" class="md-nav__link">
    Inference
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#serialization" class="md-nav__link">
    Serialization
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../cppguide/" title="C++ Guide" class="md-nav__link">
      C++ Guide
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Advanced
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Advanced
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced/efficient_tensor_creation/" title="Efficient Tensor Creation" class="md-nav__link">
      Efficient Tensor Creation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced/ope/" title="Out-of-process Execution" class="md-nav__link">
      Out-of-process Execution
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../developing/" title="Developing Neuropod" class="md-nav__link">
      Developing Neuropod
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#packaging-a-neuropod" class="md-nav__link">
    Packaging a Neuropod
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loading-a-neuropod" class="md-nav__link">
    Loading a Neuropod
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#options" class="md-nav__link">
    Options
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-the-inputs-and-outputs-of-a-model" class="md-nav__link">
    Get the inputs and outputs of a model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inference" class="md-nav__link">
    Inference
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#serialization" class="md-nav__link">
    Serialization
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="python-guide">Python Guide<a class="headerlink" href="#python-guide" title="Permanent link">&para;</a></h1>
<p>This guide walks through loading a Neuropod and running inference from Python</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The Neuropod runtime interface is identical for all frameworks so this guide applies for models from all supported frameworks (including TensorFlow, PyTorch, Keras, and TorchScript)</p>
</div>
<h2 id="packaging-a-neuropod">Packaging a Neuropod<a class="headerlink" href="#packaging-a-neuropod" title="Permanent link">&para;</a></h2>
<p>See the <a href="../tutorial/">basic introduction guide</a> for examples of how to create Neuropod models in all the supported frameworks.</p>
<h2 id="loading-a-neuropod">Loading a Neuropod<a class="headerlink" href="#loading-a-neuropod" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">neuropod.loader</span> <span class="kn">import</span> <span class="n">load_neuropod</span>

<span class="n">neuropod</span> <span class="o">=</span> <span class="n">load_neuropod</span><span class="p">(</span><span class="n">PATH_TO_MY_MODEL</span><span class="p">)</span>
</pre></div>

<p>You can also use <code>load_neuropod</code> as a context manager:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">neuropod.loader</span> <span class="kn">import</span> <span class="n">load_neuropod</span>

<span class="k">with</span> <span class="n">load_neuropod</span><span class="p">(</span><span class="n">PATH_TO_MY_MODEL</span><span class="p">)</span> <span class="k">as</span> <span class="n">neuropod</span><span class="p">:</span>
    <span class="c1"># Do something here</span>
    <span class="k">pass</span>
</pre></div>

<h3 id="options">Options<a class="headerlink" href="#options" title="Permanent link">&para;</a></h3>
<p>You can also provide runtime options when loading a model.</p>
<p>To select what device to run the model on, you can supply a <code>visible_gpu</code> argument.</p>
<p>This is the index of the GPU that this Neuropod should run on (if any). It can either be <code>None</code> or a nonnegative integer.
Setting this to <code>None</code> will attempt to run this model on CPU.</p>
<div class="codehilite"><pre><span></span><span class="c1"># Run on CPU</span>
<span class="n">neuropod</span> <span class="o">=</span> <span class="n">load_neuropod</span><span class="p">(</span><span class="n">PATH_TO_MY_MODEL</span><span class="p">,</span> <span class="n">visible_gpu</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="c1"># Run on the second GPU</span>
<span class="n">neuropod</span> <span class="o">=</span> <span class="n">load_neuropod</span><span class="p">(</span><span class="n">PATH_TO_MY_MODEL</span><span class="p">,</span> <span class="n">visible_gpu</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

<h3 id="get-the-inputs-and-outputs-of-a-model">Get the inputs and outputs of a model<a class="headerlink" href="#get-the-inputs-and-outputs-of-a-model" title="Permanent link">&para;</a></h3>
<p>The inputs and outputs of a model are available via the <code>inputs</code> and <code>outputs</code> property.</p>
<div class="codehilite"><pre><span></span><span class="k">with</span> <span class="n">load_neuropod</span><span class="p">(</span><span class="n">PATH_TO_MY_MODEL</span><span class="p">)</span> <span class="k">as</span> <span class="n">neuropod</span><span class="p">:</span>
    <span class="c1"># This is a list of dicts containing the &quot;name&quot;, &quot;dtype&quot;, and &quot;shape&quot;</span>
    <span class="c1"># of the input</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">neuropod</span><span class="o">.</span><span class="n">inputs</span><span class="p">,</span> <span class="n">neuropod</span><span class="o">.</span><span class="n">outputs</span><span class="p">)</span>
</pre></div>

<h2 id="inference">Inference<a class="headerlink" href="#inference" title="Permanent link">&para;</a></h2>
<p>The <code>infer</code> method of a model is used to run inference. The input to this method is a dict mapping input names to values. This must match the input spec in the neuropod config for the loaded model.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All the keys in this dict must be strings and all the values must be numpy arrays</p>
</div>
<p>The output of <code>infer</code> is a dict mapping output names to values. This is checked to ensure that it matches the spec in the neuropod config for the loaded model. All the keys in this dict are strings and all the values are numpy arrays.</p>
<div class="codehilite"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>

<span class="k">with</span> <span class="n">load_neuropod</span><span class="p">(</span><span class="n">ADDITION_MODEL_PATH</span><span class="p">)</span> <span class="k">as</span> <span class="n">neuropod</span><span class="p">:</span>
  <span class="n">results</span> <span class="o">=</span> <span class="n">neuropod</span><span class="o">.</span><span class="n">infer</span><span class="p">({</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">y</span><span class="p">})</span>

  <span class="c1"># array([6, 8, 10, 12])</span>
  <span class="nb">print</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;out&quot;</span><span class="p">]</span>
</pre></div>

<h2 id="serialization">Serialization<a class="headerlink" href="#serialization" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">neuropod</span> <span class="kn">import</span> <span class="n">neuropod_native</span>

<span class="c1"># An array to serialize</span>
<span class="n">tensor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># Convert a numpy array to a NeuropodTensor and serialize it</span>
<span class="n">serialized_bytes</span> <span class="o">=</span> <span class="n">neuropod_native</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">tensor</span><span class="p">)</span>

<span class="c1"># Deserialize a string of bytes to a NeuropodTensor</span>
<span class="c1"># (and return it as a numpy array)</span>
<span class="n">deserialized</span> <span class="o">=</span> <span class="n">neuropod_native</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">serialized_bytes</span><span class="p">)</span>

<span class="c1"># array([0, 1, 2, 3, 4])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">deserialized</span><span class="p">)</span>
</pre></div>

<p>Under the hood, the serialization code converts between numpy arrays and C++ NeuropodTensor objects (in a zero-copy way). It then uses the C++ serialization functionality to serialize/deserialize.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Serialization and deserialization works across Python and C++. This means you can serialize tensors in C++ and deserialize in Python or vice-versa</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The goal for this API is to support transient serialization. There are no guarantees about backwards compatibility so this API should not be used for long term storage of data</p>
</div>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../packagers/keras/" title="Keras" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Keras
              </span>
            </div>
          </a>
        
        
          <a href="../cppguide/" title="C++ Guide" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                C++ Guide
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
        <script src="https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js"></script>
      
    
  </body>
</html>